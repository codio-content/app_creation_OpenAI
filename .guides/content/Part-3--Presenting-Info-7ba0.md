Now that we have our prompt let's take care of integrating our OpenAI API key as we have done before . Ideally you will move to the top of our file. 
```python
import os
import openai
import secret
openai.api_key=secret.api_key
```

Let's create a quick function that takes a prompt and returns our movie results . This function should go between our `InBox` and `Moreflix` functions. We are going to call this function `Res` short for response. This function should work as  all the previous prompts we generated using our API. 
```python
def Res(x):
  response = openai.Completion.create(
    model="text-davinci-002",
    prompt=x,
    top_p=1,
    max_tokens=100)
  return(response['choices'][0]['text'].strip())
```
{Try It!|terminal}(python3 moflix.py)
We can add the following at the end of our code to check how `Res` behaves.

```python
Prompts=Moreflix() + "rec ="
print(Res(Prompts))
```
{Try It!|terminal}(python3 moflix.py)
After checking that everything works as intended we can change our print to a value assignment. Set the `Res` function call to the variable `movies`.
` movies=Res(Prompts)`.

We are at the finish line. We know that the response generated by GPT-3 was a string. Even though, it was a string we want to convert it to an actual list. After that we can call InBox from our list.  
```
# Converting string to list
import ast
movie_list=ast.literal_eval(movies)
InBox(movie_list)
```
{Try It!|terminal}(python3 moflix.py 8)

One last piece we are going to take care of are edge cases where the completions contains a numerated list or additional characters:

```python
import ast


Prompts=Moreflix() + "rec ="
movies=(Res(Prompts))
try:
  movie_list=ast.literal_eval(movies)
except:
  movie_list2=""
  for i in movies:
    if i=="]":
      movie_list2+=(i)
      break
    else:
      movie_list2+=(i)
  movie_list=ast.literal_eval(movie_list2)
InBox(movie_list)
```
{Try It!|terminal}(python3 moflix.py 9)

Your program should be able to generate something like the image below. 


![rec](rec.png)
If some reason your code is failing and you cannot understand why, feel free to compare your code with the following:
<details>
 <summary>
    <b> Click here to see the code solution</b>
 </summary><blockquote>

```python 
import os
import openai
import secret
openai.api_key=secret.api_key


import ast
# print element of a list in nice box for the user
def InBox(x):
  x=(["Movie Recommendations"]+x)
  #this gives you the longest string
  biggest = max(x, key = len)
  #THIS GETS the len of the biggest string
  biggest=len(biggest)
  #creating our box
  print("+" + "-" * (biggest + 2) + "+")
  for i in x:
    print("| " + i + (" "*(biggest-len(i))) + " |")
    print("+" + "-" * (biggest + 2) + "+")

def Res(x):
  response = openai.Completion.create(
    model="text-davinci-002",
    prompt=x,
    temperature=0,
    top_p=1,
    max_tokens=100)
  return(response['choices'][0]['text'].strip())

def Moreflix():
  # ask the user for different inputs
  number_recs=input('How many movies do you want recommended: ')
  genre=input('What genre are you looking for: ')
  similar=input('What is a similar movie: ')
  if number_recs=="0":
    number_recs=5
  if genre=="0" and similar=="0":
    return("In a python list form, give me " + str(number_recs) +" movie recommendation")
  if genre=="0" :
    return ("In a python list form, give me " + str(number_recs) +" movie recommendation, similar to " + similar)
  if similar=="0":
    return ("In a python list form, give me "+ str(number_recs)+ " " + genre + " movie recommendation")
  return ("In a python list form, give me "+str(number_recs)+" "+genre +" movie recommendation similar to " + similar)

Prompts=Moreflix() + "rec ="
movies=(Res(Prompts))
try:
  movie_list=ast.literal_eval(movies)
except:
  movie_list2=""
  for i in movies:
    if i=="]":
      movie_list2+=(i)
      break
    else:
      movie_list2+=(i)
  movie_list=ast.literal_eval(movie_list2)

InBox(movie_list)



```
 </blockquote></details>
<br>

{Check It!|assessment}(multiple-choice-415787891)
